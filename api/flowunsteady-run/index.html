<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>(5) Run Simulation · FLOWUnsteady</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-B7CBF7WC7L"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-B7CBF7WC7L', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="FLOWUnsteady logo"/></a><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Intro</a></li><li><a class="tocitem" href="../../installation/general/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Simple Wing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/wing-4p2aoa/">Basics</a></li><li><a class="tocitem" href="../../examples/wing-aoasweep/">AOA Sweep</a></li></ul></li><li><a class="tocitem" href="../../examples/tetheredwing/">Tethered Wing</a></li><li><a class="tocitem" href="../../examples/heavingwing/">Heaving Wing</a></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Propeller</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/propeller-J040/">Basics</a></li><li><a class="tocitem" href="../../examples/propeller-jsweep/"><span>$J$</span> Sweep</a></li><li><a class="tocitem" href="../../examples/propeller-quasisteady/">Quasi-Steady Solver</a></li><li><a class="tocitem" href="../../examples/propeller-incidence/">Incidence Sweep</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Rotor in Hover</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/rotorhover-aero/">Variable Fidelity</a></li><li><a class="tocitem" href="../../examples/rotorhover-fdom/">Fluid Domain</a></li><li><a class="tocitem" href="../../examples/rotorhover-acoustics/">Aeroacoustics</a></li><li><a class="tocitem" href="../../examples/rotorhover-quasisteady/">Quasi-Steady Solver</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Blown Wing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/blownwing-aero/">Aerodynamic Solution</a></li><li><a class="tocitem" href="../../examples/blownwing-asm/">Actuator Surface Model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">eVTOL Aircraft</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/vahana-vehicle/">Vehicle Definition</a></li><li><a class="tocitem" href="../../examples/vahana-maneuver/">Maneuver Definition</a></li><li><a class="tocitem" href="../../examples/vahana-monitor/">Monitors Definitions</a></li><li><a class="tocitem" href="../../examples/vahana-run/">Run Simulation</a></li></ul></li></ul></li><li><a class="tocitem" href="../../visualization/">Visualization</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../theory/rvpm/">Reformulated VPM</a></li><li><a class="tocitem" href="../../theory/convergence/">Convergence</a></li><li><a class="tocitem" href="../../theory/validation/">Validation</a></li><li><a class="tocitem" href="../../theory/publications/">Publications</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox" checked/><label class="tocitem" for="menuitem-7"><span class="docs-label">API Guide</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">(1) Vehicle Definition</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../flowunsteady-vehicle-types/">Vehicle types</a></li><li><a class="tocitem" href="../flowunsteady-vehicle-components/">Generating components</a></li><li><a class="tocitem" href="../flowunsteady-vehicle-asm/">Actuator surface model</a></li></ul></li><li><a class="tocitem" href="../flowunsteady-maneuver/">(2) Maneuver Definition</a></li><li><a class="tocitem" href="../flowunsteady-simulation/">(3) Simulation Definition</a></li><li><a class="tocitem" href="../flowunsteady-monitor/">(4) Monitors Definitions</a></li><li class="is-active"><a class="tocitem" href>(5) Run Simulation</a></li><li><input class="collapse-toggle" id="menuitem-7-6" type="checkbox"/><label class="tocitem" for="menuitem-7-6"><span class="docs-label">(6) Viz and Postprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../flowunsteady-postprocessing-fdom/">Fluid Domain</a></li><li><a class="tocitem" href="../flowunsteady-postprocessing-noise/">Aeroacoustic Noise</a></li><li><a class="tocitem" href="../flowunsteady-postprocessing-misc/">Miscellaneous</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-7" type="checkbox"/><label class="tocitem" for="menuitem-7-7"><span class="docs-label">Extras</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-7-1"><span class="docs-label">FLOWVPM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../flowvpm-particle/">Particle Field</a></li><li><a class="tocitem" href="../flowvpm-uj/">UJ Scheme</a></li><li><a class="tocitem" href="../flowvpm-viscous/">Viscous Scheme</a></li><li><a class="tocitem" href="../flowvpm-relaxation/">Relaxation Scheme</a></li><li><a class="tocitem" href="../flowvpm-sfs/">SFS Scheme</a></li><li><a class="tocitem" href="../flowvpm-time/">Time Integration</a></li><li><a class="tocitem" href="../flowvpm-utils/">Utilities</a></li></ul></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API Guide</a></li><li class="is-active"><a href>(5) Run Simulation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>(5) Run Simulation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/byuflowlab/FLOWUnsteady/blob/master/docs/src/api/flowunsteady-run.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="(5)-Run-Simulation"><a class="docs-heading-anchor" href="#(5)-Run-Simulation">(5) Run Simulation</a><a id="(5)-Run-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#(5)-Run-Simulation" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="FLOWUnsteady.run_simulation" href="#FLOWUnsteady.run_simulation"><code>FLOWUnsteady.run_simulation</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Run the FLOWUnsteady simulation <code>sim</code> in <code>nsteps</code> number of time steps.</p><pre><code class="language-julia hljs">run_simulation(

    sim::Simulation,                    # Simulation object
    nsteps::Int;                        # Total time steps in simulation

    # -------- SIMULATION OPTIONS -----------------------------------------
    Vinf            = (X, t)-&gt;zeros(3), # Freestream velocity
    sound_spd       = 343,              # (m/s) speed of sound
    rho             = 1.225,            # (kg/m^3) air density
    mu              = 1.81e-5,          # (Pa*s) air dynamic viscosity
    tquit           = Inf,              # (s) force quit the simulation at this time
    rand_RPM        = false,            # (experimental) randomize RPM fluctuations

    extra_runtime_function = (sim, PFIELD, T, DT; optargs...)-&gt;false,

    # -------- SOLVERS OPTIONS --------------------------------------------
    # Vortex particle method
    max_particles   = Int(1e5),         # Maximum number of particles
    max_static_particles = nothing,     # Maximum number of static particles (use `nothing` to automatically estimate it)
    p_per_step      = 1,                # Particle sheds per time step
    vpm_formulation = vpm.rVPM,         # VPM formulation (`vpm.rVPM` or `vpm.cVPM`)
    vpm_kernel      = vpm.gaussianerf,  # VPM kernel (`vpm.gaussianerf` or `vpm.winckelmans`)
    vpm_UJ          = vpm.UJ_fmm,       # VPM particle-to-particle interaction scheme (`vpm.UJ_fmm` or `vpm.UJ_direct`)
    vpm_SFS         = vpm.SFS_none,     # VPM LES subfilter-scale model (`SFS_none`, `SFS_Cd_threelevel_nobackscatter`, `SFS_Cd_twolevel_nobackscatter`, or `SFS_Cs_nobackscatter`)
    vpm_integration = vpm.rungekutta3,  # VPM time integration scheme (`vpm.euler` or `vpm.rungekutta3`)
    vpm_transposed  = true,             # VPM transposed stretching scheme
    vpm_viscous     = vpm.Inviscid(),   # VPM viscous diffusion scheme (`vpm.Inviscid()`, `vpm.CoreSpreading(nu, sgm0, zeta)`, or `vpm.ParticleStrengthExchange(nu)`)
    vpm_fmm         = vpm.FMM(; p=4, ncrit=50, theta=0.4, phi=0.5), # VPM&#39;s FMM settings
    vpm_relaxation  = vpm.pedrizzetti,  # VPM relaxation scheme (`vpm.norelaxation`, `vpm.correctedpedrizzetti`, or `vpm.pedrizzetti`)
    vpm_surface     = true,             # Whether to include surfaces in the VPM through ASM/ALM

    # Actuator surface/line model (ASM/ALM): VLM and blade elements
    vlm_vortexsheet = false,            # Whether to spread surface circulation as a vortex sheet in the VPM (turns ASM on; ALM if false)
    vlm_vortexsheet_overlap     = 2.125,# Overlap of particles that make the vortex sheet
    vlm_vortexsheet_distribution= g_pressure, # Vorticity distribution of vortex sheet (`g_uniform`, `g_linear`, or `g_pressure`)
    vlm_vortexsheet_sigma_tbv   = nothing, # Size of particles in trailing bound vortices (defaults to `sigma_vlm_surf` if not given)
    vlm_rlx         = -1,               # VLM relaxation (&gt;0.9 can cause divergence, &lt;0.2 slows simulation too much, deactivated with &lt;0)
    vlm_init        = false,            # Initialize the first step with the VLM semi-infinite wake solution
    hubtiploss_correction = vlm.hubtiploss_nocorrection, # Hub and tip loss correction of rotors (ignored in quasi-steady solver)

    # Wake shedding
    wake_coupled        = true,         # Couple VPM wake -&gt; VLM solution
    shed_unsteady       = true,         # Whether to shed vorticity from unsteady loading
    unsteady_shedcrit   = 0.01,         # Criterion for unsteady-loading shedding
    shed_starting       = false,        # Whether to shed starting vortex (only when `shed_unsteady=true`)
    shed_boundarylayer  = false,        # (experimental) whether to shed vorticity from boundary layer of surfaces
    boundarylayer_prescribedCd = 0.1,   # (experimental) prescribed Cd for boundary layer shedding used for wings
    boundarylayer_d     = 0.0,          # (experimental) dipole width for boundary layer shedding
    omit_shedding       = [],           # Indices of elements in `sim.vehicle.wake_system` on which omit shedding VPM particles

    # Regularization of solvers
    sigma_vlm_solver    = -1,           # Regularization of VLM solver (internal VLM-on-VLM)
    sigma_vlm_surf      = -1,           # (REQUIRED!) Size of embedded particles in ASM/ALM wing surfaces (for VLM-on-VPM and VLM-on-Rotor)
    sigma_rotor_surf    = -1,           # (REQUIRED!) Size of embedded particles in ALM blade surfaces (for Rotor-on-VPM, Rotor-on-VLM, and Rotor-on-Rotor)
    sigmafactor_vpm     = 1.0,          # Core overlap of wake particles
    sigmafactor_vpmonvlm = 1,           # (experimental) shrinks the particles by this factor when calculating VPM-on-VLM/Rotor induced velocities
    sigma_vpm_overwrite = nothing,      # Overwrite core size of wake to this value (ignoring `sigmafactor_vpm`)

    # -------- RESTART OPTIONS --------------------------------------------
    restart_vpmfile     = nothing,      # VPM restart file to restart simulation

    # -------- OUTPUT OPTIONS ---------------------------------------------
    save_path       = nothing,          # Where to save simulation
    run_name        = &quot;flowunsteadysim&quot;,# Suffix of output files
    create_savepath = true,             # Whether to create `save_path`
    prompt          = true,             # Whether to prompt the user
    verbose         = true,             # Enable verbose
    v_lvl           = 0,                # Indentation level of verbose
    verbose_nsteps  = 10,               # Verbose every this many steps
    raisewarnings   = true,             # Whether to raise warnings
    debug           = false,            # Output extra states for debugging
    nsteps_save     = 1,                # Save vtks every this many steps
    nsteps_restart  = -1,               # Save jlds every this many steps (restart files)
    save_code       = &quot;&quot;,               # Copy the source code in this path to `save_path`
    save_horseshoes = false,            # Whether to output VLM horseshoes in VTKs
    save_static_particles = true,       # Whether to save ASM/ALM embedded particles
    save_wopwopin   = false,            # Generate input files for PSU-WOPWOP

)</code></pre><p>Even though a bast number of settings are exposed to the user, the only required keyword arguments are <code>sigma_vlm_surf</code> and <code>sigma_rotor_surf</code>. Thus, running the simulation can be as simple as</p><pre><code class="language-julia hljs">run_simulation(sim::Simulation, nsteps::Int;
                    sigma_vlm_surf = ..., sigma_rotor_surf = ...)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/byuflowlab/FLOWUnsteady/blob/feda2183b4a939ac4c1fb92d3b67a3864d783a49/src/FLOWUnsteady_simulation.jl#L11-L106">source</a></section></article><div class="admonition is-compat"><header class="admonition-header">Extra Runtime Function</header><div class="admonition-body"><p><code>extra_runtime_function</code> is a function that is called at every time step after the state variables are updated and before outputting VTK files. The state variables of the simulation are passed to this function, giving the user complete freedom to modify the states of the simulation (<em>e.g.</em>, add/remove particles, clip vortex strengths, re-orient the vehicle) or to do some extra computation (<em>e.g.</em>, compute aerodynamic forces, create plots, write to files, etc).</p><p>This function is expected be of the form</p><pre><code class="nohighlight hljs">extra_runtime_function(sim, pfield, t, dt; vprintln) -&gt; Bool</code></pre><p>where <code>sim</code> is the <a href="../flowunsteady-simulation/#FLOWUnsteady.Simulation"><code>FLOWUnsteady.Simulation</code></a> object, <code>pfield</code> is the <a href="api/@ref"><code>FLOWVPM.ParticleField</code></a>, <code>t</code> is the current simulation time, <code>dt</code> is the length of the current time step, and <code>vprintln(str, v_lvl)</code> is a function for printing the verbose of the simulation (default to <code>vprintln = (args...)-&gt;nothing</code> if there is nothing to add to the verbose).</p><p>The output of <code>extra_runtime_function</code> is a flag for breaking the simulation at the current time step, such that if it ever returns <code>true</code>, the simulation will immediately quit.</p></div></div><div class="admonition is-compat"><header class="admonition-header">So, what is going on under the hood?</header><div class="admonition-body"><p>FLOWUnsteady is simply a runtime function that is provided to FLOWVPM, as shown below. Hence, FLOWVPM (green block) is the solver that is actually driving the simulation. FLOWUnsteady (blue block) acts as a runtime function inside a VPM simulation that at each time step uses the solvers in the gray block to compute surface vorticities and adds particles to embed such vorticity in the flow field (thus implementing the actuator surface/line models developed in <a href="https://scholarsarchive.byu.edu/etd/9589/">Alvarez&#39; dissertation</a>, Chapter 6).</p><p>This workflow makes it very easy to couple more solvers in the simulation. For instance, a structural solver can be inserted as a runtime function (step 6 of the blue block) that deflects the geometry according to the aerodynamic loads, obtaining a full aeroelastic simulation.</p></div></div><center>
  <img src="../../assets/images/flowchart/flowchart00.png" alt="Pic here" style="width: 100%;"/>
</center></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../flowunsteady-monitor/">« (4) Monitors Definitions</a><a class="docs-footer-nextpage" href="../flowunsteady-postprocessing-fdom/">Fluid Domain »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 7 April 2023 04:58">Friday 7 April 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
